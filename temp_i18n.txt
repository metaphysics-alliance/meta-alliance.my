import React, { createContext, useContext, useEffect, useMemo, useState } from 'react'

const dict = {
  EN: {
    brand_top: '玄域联盟',
    brand_bottom: 'Metaphysics Alliance',
    who_title: 'Who We Are',
    who_long: `Metaphysics Alliance is a Malaysia‑based boutique dedicated to turning classical Chinese metaphysics into clear, practical guidance. We combine BaZi, Zi Wei Dou Shu, Qi Men Dun Jia, Feng Shui, Huangji, Taiyi, Liu Ren and modern numerology to illuminate timing, strategy and design. Every reading is anchored to True Solar Time and the 24 Solar Terms, cross‑checked with authoritative calendars to protect accuracy.`,
    why_title: 'Why Choose Us?',
    why_long: `Choose Metaphysics Alliance for rigor, clarity and timing. We triangulate BaZi, Zi Wei, Qi Men, Feng Shui, Huangji, Taiyi, Liu Ren and numerology so recommendations are cross‑validated, not single-method guesses.`,
    reviews_title: "What Our Client's Says About Us",
    newsletter_title: 'Newsletter',
    newsletter_sub: 'Insights, timing windows & case studies. No spam.',
    newsletter_placeholder: 'Enter your email',
    newsletter_button: 'Subscribe',
    map_title: 'Our Location',
    nav: {
      home: 'Home',
      celestial: 'Celestial Analysis',
      bazi: 'BaZi Analysis',
      ziwei: 'Zi Wei Dou Shu',
      qimen: 'Qi Men Dun Jia',
      fengshui: 'Feng Shui',
      fengshui_res: 'Residential Feng Shui',
      fengshui_com: 'Commercial Feng Shui',
      name_number: 'Name & Number',
      soul_matrix: 'Soul Path Matrix',
      cosmic_name: 'Cosmic Name Architecture',
      oracles: 'Oracles',
      celestial_numbers: 'Supreme Celestial Numbers',
      taiyi_numbers: 'Supreme Tai Yi Numbers',
      six_ren: 'Cosmic Six Ren',
      vip_report: 'VIP Package',
      vip_essential: 'Essential Destiny Blueprint',
      vip_advanced: 'Advanced Destiny Blueprint',
      vip_supreme: 'Supreme Destiny Blueprint',
      academy: 'Academy',
      courses: 'Courses Overview',
      beginner: 'Beginner',
      advanced: 'Advanced',
      pro: 'Professional Certification',
      calendar: 'Calendar & Booking',
      enterprise: 'Enterprise',
      audit: 'Corporate Audit',
      site: 'Site Selection',
      cycles: 'Strategy & Cycles',
      resources: 'Resources',
      four_pillars: 'Cosmic Four Pillars Chart',
      purple_star: 'Celestial Star Oracle Chart',
      about: 'About',
      contact: 'Contact',
      celestial_groups: [
        {
          title: 'Destiny Blueprint',
          items: [
            { title: 'Destiny Algorithm (BaZi)', href: '/services/celestial/destiny-algorithm' },
            { title: 'Imperial Star Atlas (Zi Wei Dou Shu)', href: '/services/celestial/imperial-star-atlas' },
            { title: 'Arcane Strategy Matrix (Qi Men Dun Jia)', href: '/services/celestial/arcane-strategy-matrix' },
          ],
        },
        {
          title: 'Feng Shui Assessment',
          items: [
            { title: 'Home Destiny Compass', href: '/services/fengshui/home-destiny-compass' },
            { title: 'Office Power Alignment', href: '/services/fengshui/office-power-alignment' },
            { title: 'Dragon Vein Oracle', href: '/services/fengshui/dragon-vein-oracle' },
          ],
        },
        {
          title: 'Feng Shui Layout',
          items: [
            { title: 'Cosmic Cycle of Fate', href: '/services/fengshui/cosmic-cycle-of-fate' },
            { title: 'Celestial Star Matrix', href: '/services/fengshui/celestial-star-matrix' },
            { title: 'Energy Convergence Field', href: '/services/fengshui/energy-convergence-field' },
          ],
        },
        {
          title: 'Magnetic Matrix',
          items: [
            { title: 'I-Ching Energy Matrix', href: '/services/magnetic-matrix/i-ching-energy-matrix' },
            { title: 'Name Destiny Code', href: '/services/magnetic-matrix/name-destiny-code' },
            { title: 'Soul Number Blueprint', href: '/services/magnetic-matrix/soul-number-blueprint' },
          ],
        },
      ],
    },
  vip: {
    section_title: 'VIP Holistic Destiny Analysis Service',
    cta: 'Learn More',
    tiers: {
      lite_title: 'Essential Destiny Blueprint',
      pro_title: 'Advanced Destiny Blueprint',
      supreme_title: 'Supreme Destiny Blueprint',
      lite_points: [
        '100+ page destiny report',
        'Talents & potentials, destined industries, earning models',
        '10-year Luck Pillars (Da Yun) analysis',
        'Life numbers (numerology) analysis',
        'Practical remediation advice'
      ],
      pro_points: [
        '200+ page destiny report',
        'Talents & potentials, destined industries, earning models',
        '10-year Luck Pillars (Da Yun) analysis',
        'Life numbers (numerology) analysis',
        'Practical remediation advice',
        'Numeric field analysis',
        'Name auspiciousness analysis'
      ],
      supreme_points: [
        '300+ page destiny report',
        'Talents & potentials, destined industries, earning models',
        '10-year Luck Pillars (Da Yun) analysis',
        'Life numbers (numerology) analysis',
        'Practical remediation advice',
        'Numeric field analysis & change recommendations',
        'Name auspiciousness analysis & change recommendations',
        'Feng Shui evaluation (residential only)'
      ]
    },
  },
    hero: {
      slide1_title: 'The Ultimate Destiny Matrix',
      slide1_sub: 'From BaZi to Stars, Numbers to Hexagrams — A Unified Destiny Analysis',
      slide2_title: 'The Three Celestial Codes',
      slide2_sub: 'Ancient Strategic Algorithms of Destiny, Revived Today',
      slide3_title: 'Cosmic Energy Arrangement',
      slide3_sub: 'Ancient Spatial Wisdom for Modern Success',
      slide4_title: 'Heaven–Earth–Human Grid & I-Ching Energy Matrix',
      slide4_sub: 'Decoding Names and Numbers through Heaven–Earth–Human Trinity and I-Ching Resonance',
      slide5_title: 'Corporate Destiny Blueprint & Opportunity Matrix',
      slide5_sub: 'Harnessing BaZi, Zi Wei, Qi Men, and Feng Shui for Corporate Growth'
    },
  },
  CN: {
    brand_top: '玄域联盟',
    brand_bottom: 'Metaphysics Alliance',
    who_title: '我们是谁',
    who_long: '玄域联盟立足马来西亚，以严谨与实用为核心，将传统玄学转化为可执行方案。我们综合八字、紫微、奇门、风水、皇极、太乙、六壬与数字命理，并以真太阳时与二十四节气为基准。',
    why_title: '为什么选择我们？',
    why_long: '我们以多术数交叉印证替代单一判断；先校正真太阳时，再验证节气节点，降低误差。',
    reviews_title: '客户对我们的评价',
    newsletter_title: '订阅资讯',
    newsletter_sub: '实战洞见、时机窗口与案例解读。拒绝骚扰。',
    newsletter_placeholder: '输入邮箱',
    newsletter_button: '订阅',
    map_title: '地理位置',
    nav: {
      home: '首页',
      celestial: '天命解析',
      bazi: '八字命理',
      ziwei: '紫微斗数',
      qimen: '奇门遁甲',
      fengshui: '风水',
      fengshui_res: '住宅风水',
      fengshui_com: '商业风水',
      name_number: '姓名数理',
      soul_matrix: '灵魂矩阵',
      cosmic_name: '星命命名',
      oracles: '占卜体系',
      celestial_numbers: '天体灵数',
      taiyi_numbers: '太乙神算',
      six_ren: '六壬天机',
      vip_report: 'VIP 报告',
      vip_essential: '基础命运蓝图',
      vip_advanced: '高级命运蓝图',
      vip_supreme: '尊享命运蓝图',
      academy: '学院',
      courses: '课程概览',
      beginner: '初阶课程',
      advanced: '进阶课程',
      pro: '专业认证',
      calendar: '预约日历',
      enterprise: '企业咨询',
      audit: '企业风水审计',
      site: '选址布局',
      cycles: '战略周期',
      resources: '资源库',
      four_pillars: '四柱命盘',
      purple_star: '紫微星图',
      about: '关于我们',
      contact: '联系我们',
      celestial_groups: [
        {
          title: '天命蓝图',
          items: [
            { title: '命运算法', href: '/services/celestial/destiny-algorithm' },
            { title: '帝星天图', href: '/services/celestial/imperial-star-atlas' },
            { title: '玄机战策', href: '/services/celestial/arcane-strategy-matrix' },
          ]
        },
        {
          title: '风水评估',
          items: [
            { title: '宅运天机', href: '/services/fengshui/home-destiny-compass' },
            { title: '权势风水', href: '/services/fengshui/office-power-alignment' },
            { title: '龙脉圣图', href: '/services/fengshui/dragon-vein-oracle' },
          ]
        },
        {
          title: '风水布局',
          items: [
            { title: '三元九运', href: '/services/fengshui/cosmic-cycle-of-fate' },
            { title: '玄空飞星', href: '/services/fengshui/celestial-star-matrix' },
            { title: '造化能域', href: '/services/fengshui/energy-convergence-field' },
          ]
        },
        {
          title: '磁场矩阵',
          items: [
            { title: '太极数场', href: '/services/magnetic-matrix/i-ching-energy-matrix' },
            { title: '名格天命', href: '/services/magnetic-matrix/name-destiny-code' },
            { title: '灵数天机', href: '/services/magnetic-matrix/soul-number-blueprint' },
          ]
        },
      ],
    },
  vip: {
    section_title: 'VIP 全维命运解析服务',
    cta: '了解更多',
    tiers: {
      lite_title: '基础命运蓝图',
      pro_title: '进阶命运蓝图',
      supreme_title: '尊享命运蓝图',
      lite_points: [
        '100+ 页命运报告',
        '天赋潜能 · 行业定位 · 财运模式',
        '十年大运交替分析',
        '生命数字命理解析',
        '实用化解建议'
      ],
      pro_points: [
        '200+ 页命运报告',
        '天赋潜能 · 行业定位 · 财运模式',
        '十年大运交替分析',
        '生命数字命理解析',
        '实用化解建议',
        '数理能量场分析',
        '姓名吉象解析'
      ],
      supreme_points: [
        '300+ 页命运报告',
        '天赋潜能 · 行业定位 · 财运模式',
        '十年大运交替分析',
        '生命数字命理解析',
        '实用化解建议',
        '数理能量场分析与修正建议',
        '姓名吉象分析与优化建议',
        '住宅风水评估'
      ]
    },
  },
    hero: {
      slide1_title: '天命蓝图 · VIP 专属',
      slide1_sub: '从四柱到星曜，从数字到卦象，一次尽览命理全图',
      slide2_title: '天机三绝 · 皇极·太乙·六壬',
      slide2_sub: '古代帝王的终极战略推演术数',
      slide3_title: '空间能量布阵',
      slide3_sub: '古老空间智慧，成就现代高峰',
      slide4_title: '三才命格蓝图 · 易经能量矩阵',
      slide4_sub: '以天人地三才与易数能量，解锁姓名与命运奥秘',
      slide5_title: '企业命运蓝图 · 商机矩阵',
      slide5_sub: '融合八字、紫微、奇门、风水，助力企业腾飞'
    },
  },
}

const I18nContext = createContext(null)

export function I18nProvider({ children }){
  const initial = (typeof window !== 'undefined' && localStorage.getItem('lang')) || 'EN'
  const [lang, setLang] = useState(initial === 'CN' ? 'CN' : 'EN')

  useEffect(() => { if (typeof window !== 'undefined') localStorage.setItem('lang', lang) }, [lang])

  const value = useMemo(() => ({
    lang, setLang,
    t: (path) => {
      const parts = path.split('.')
      let cur = dict[lang]
      for (const p of parts) { if (cur && p in cur) cur = cur[p]; else return path }
      return cur
    },
    tt: (key) => dict[lang][key] ?? key,
    reviews: () => dict[lang].reviews
  }), [lang])

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>
}

export function useI18n(){
  const ctx = useContext(I18nContext)
  if (!ctx) throw new Error('useI18n must be used within I18nProvider')
  return ctx
}
